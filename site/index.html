<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>JUNNAã®å…­æ³•</title>
<style>
:root {
  --bg: #fffafc;
  --card: #ffffff;
  --text: #374151;
  --sub: #9ca3af;

  --pink: #fde2e4;
  --mint: #e8f8f5;
  --lav:  #f3ecff;

  font-family: -apple-system, BlinkMacSystemFont,
    "Hiragino Maru Gothic ProN","Hiragino Sans","Yu Gothic UI",
    system-ui, sans-serif;

  line-height: 1.75;
}

* { box-sizing: border-box; }
body {
  margin: 0;
  background: linear-gradient(180deg, var(--bg), #ffffff);
  color: var(--text);
  overflow-x: hidden;
}

header{
  position: sticky;
  top: 0;
  background: rgba(255,255,255,0.85);
  backdrop-filter: blur(10px);
  border-bottom: 1px solid rgba(0,0,0,.06);
  padding: 10px 12px; /* â† 12â†’10 ã«ã—ã¦å°‘ã—ä½ã */
  z-index: 10;
}


main {
  padding: 14px 12px calc(24px + env(safe-area-inset-bottom));
  max-width: 760px;
  margin: 0 auto;
}

.card {
  background: var(--card);
  border-radius: 24px;
  padding: 16px 14px;
  margin-bottom: 14px;
  box-shadow: 0 8px 24px rgba(0,0,0,.04), 0 2px 6px rgba(0,0,0,.03);
}

.badge {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 7px 12px;
  border-radius: 999px;
  background: linear-gradient(90deg, var(--pink), var(--lav));
  border: 1px solid rgba(0,0,0,.04);
  font-size: 13px;
  color: #111827;
  font-weight: 800;
}

.micon{
  width: 22px; height: 22px;
  display: inline-grid; place-items: center;
  border-radius: 999px;
  background: rgba(255,255,255,0.85);
  border: 1px solid rgba(0,0,0,.06);
  box-shadow: 0 2px 6px rgba(0,0,0,.06);
}
.micon svg{ width: 18px; height: 18px; display:block; }

.small { color: var(--sub); font-size: 0.92em; margin-top: 6px; }
hr { border: none; border-top: 1px solid rgba(0,0,0,.08); margin: 12px 0; }

label { display: block; font-weight: 800; margin-top: 10px; }
input {
  width: 100%;
  font-size: 16px;
  padding: 11px 12px;
  border-radius: 16px;
  border: 1px solid rgba(0,0,0,.10);
  background: #fff;
}

button {
  font-size: 16px;
  padding: 11px 14px;
  border-radius: 999px;
  border: 1px solid rgba(0,0,0,.10);
  background: linear-gradient(90deg, var(--mint), var(--lav));
  color: #111827;
  margin-top: 10px;
}

.navrow { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
.navbtn {
  display: inline-flex; align-items: center; gap: 8px;
  padding: 9px 12px;
  border-radius: 999px;
  text-decoration: none;
  border: 1px solid rgba(0,0,0,.10);
  background: #fff;
  color: #111827;
}
.navbtn.primary { background: linear-gradient(90deg, var(--mint), var(--lav)); }
.navbtn:active { opacity: .7; }

.result { padding: 10px 4px; border-bottom: 1px dashed rgba(0,0,0,.12); }
.result a { text-decoration: none; display: block; color: #111827; }

.p { margin: 0 0 12px; }
.sp { height: 6px; }
.cute-list { margin: 8px 0 14px 18px; padding: 0; }
.cute-list li { margin: 8px 0; }

.loading {
  display:inline-flex; align-items:center; gap:8px;
  padding:8px 10px;
  border-radius:999px;
  border:1px solid rgba(0,0,0,.08);
  background: rgba(255,255,255,.8);
  color:#374151;
  font-size: 14px;
}
.dot {
  width:10px;height:10px;border-radius:999px;
  background: linear-gradient(90deg, var(--pink), var(--lav));
  box-shadow: 0 2px 6px rgba(0,0,0,.06);
}

.artbox{
  border:1px solid rgba(0,0,0,.08);
  border-radius: 20px;
  padding: 14px 12px;
  margin: 12px 0;
  background: linear-gradient(180deg, rgba(232,248,245,.35), rgba(243,236,255,.35));
}
.arthead{
  font-weight: 900;
  margin: 0 0 8px;
  display:flex;
  align-items:center;
  gap:4px;
}
.artnum{
  display:inline-flex;
  align-items:center;
  padding: 6px 10px;
  border-radius: 999px;
  background: rgba(255,255,255,.8);
  border:1px solid rgba(0,0,0,.06);
  font-size: 13px;
}
.toc a{ text-decoration:none; color:#111827; }
.toc a:hover{ text-decoration:underline; }
/* ã‚¢ãƒ³ã‚«ãƒ¼ç§»å‹•ã§ãƒ˜ãƒƒãƒ€ãƒ¼ã«éš ã‚Œãªã„ã‚ˆã†ã«ã™ã‚‹ */
.artbox{
  scroll-margin-top: 90px;
}
/* æ³•ä»¤ãƒšãƒ¼ã‚¸ã®ãƒ˜ãƒƒãƒ€ãƒ¼å†…ï¼šæ¡ç•ªå·ã‚¸ãƒ£ãƒ³ãƒ— */
.headbar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  flex-wrap:wrap;
}
/* æ¡ç•ªå·ã‚¸ãƒ£ãƒ³ãƒ—è¡Œ */
.headjump{
  display:flex;
  gap:8px;
  width:100%;
  justify-content:flex-end;  /* å³å¯„ã› */
}

/* â˜…ã“ã“ã§å¹…ã‚’ç‹­ãã™ã‚‹ */
.headjump input{
  flex: 0 0 auto;
  width: min(80px, 55vw);   /* â†ç‹­ã‚ï¼ˆæ•°å€¤ã¯å¥½ã¿ã§èª¿æ•´ï¼‰ */
  padding: 9px 10px;
  border-radius: 999px;
}

.headjump button{
  margin-top:0;
  padding: 9px 12px;
  border-radius: 999px;
  white-space:nowrap;
}

/* å°ã•ã„ç”»é¢ã¯å°‘ã—ã ã‘åºƒã’ã‚‹ï¼ˆå…¥åŠ›ã—ã‚„ã™ã•å„ªå…ˆï¼‰ */
@media (max-width: 520px){
  .headjump input{
    width: min(220px, 62vw);
  }
/* ãµã‚ã£ã¨æ„ŸUP */
.card{
  box-shadow: 0 10px 30px rgba(0,0,0,.05), 0 2px 8px rgba(0,0,0,.03);
  border: 1px solid rgba(0,0,0,.04);
}

/* ãƒœã‚¿ãƒ³ã‚’ã·ã«ã£ã¨ */
button, .navbtn{
  transition: transform .06s ease, filter .12s ease;
}
button:active, .navbtn:active{
  transform: translateY(1px) scale(0.98);
  filter: brightness(0.98);
}

/* è¦‹å‡ºã—ãƒãƒƒã‚¸ã‚’ã‚‚ã£ã¨â€œãŠè“å­â€ã£ã½ã */
.badge{
  box-shadow: 0 6px 18px rgba(0,0,0,.06);
}



/* å…¥åŠ›æ¬„ã‚’â€œã·ã«â€ */
input{
  border: 1px solid rgba(0,0,0,.08);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.8);
}
input:focus{
  outline: none;
  border-color: rgba(244,114,182,.35);
  box-shadow: 0 0 0 4px rgba(244,114,182,.10);
}

}
.hit { outline: 3px solid rgba(253, 226, 228, .9); }
.mark { background: rgba(253, 226, 228, .75); border-radius: 6px; padding: 0 2px; }
/* ===== iPhoneç­‰ã®ç‹­ã„ç”»é¢ã ã‘ã€ãƒ˜ãƒƒãƒ€ãƒ¼å†…æ¤œç´¢UIã‚’åœ§ç¸® ===== */
.lawbar{
  display:flex;
  align-items:center;
  gap:8px;
  flex-wrap:wrap;
}

.lawbar .field{
  display:flex;
  align-items:center;
  gap:4px;
}
.lawbar .field-kw{
  flex: 0 1 auto;   /* â† â€œå¿…è¦ãªåˆ†ã ã‘â€ã«å¯„ã›ã‚‹ */
}

.lawbar input{
  width:auto;
}

.lawbar .artjump{
  width: 9.5em;         /* æ¡ç•ªå·ã¯çŸ­ã‚ã§OK */
  max-width: 45vw;
  flex: 0 0 auto;
}

.lawbar .kw{
  flex: 1 1 9.5em;       /* â˜…ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’åºƒã’ã‚‹ï¼ˆå„ªå…ˆï¼‰ */
  min-width: 12em;
  max-width: 45vw;
}

/* ãƒœã‚¿ãƒ³ã‚’å°‘ã—å°ã•ã */
.lawbar .mini-btn{
  padding: 8px 10px;
  font-size: 14px;
}

/* iPhoneæƒ³å®šã®ã•ã‚‰ã«åœ§ç¸® */
@media (max-width: 480px){
  header{ padding: 10px 10px; }
  .badge{ padding: 6px 10px; font-size: 12px; }
  .micon{ width: 20px; height: 20px; }
  .lawbar{ gap:6px; }

/* å¤‰æ›´å¾Œï¼šiPhoneã§ã‚‚åŒã˜å¹… */
.lawbar .artjump,
.lawbar .kw{
  width: 7.0em;
  max-width: 42vw;
}


  /* å…¥åŠ›è‡ªä½“ã‚‚å°‘ã—å°ã•ã‚ */
  .lawbar input{
    padding: 9px 10px;
    border-radius: 14px;
    font-size: 15px;
  }
}
/* æ¤œç´¢çµæœè¡¨ç¤ºï¼ˆkwstatusï¼‰ãŒæ¨ªå¹…ã‚’é£Ÿã£ã¦æŠ˜ã‚Šè¿”ã—å´©ã‚Œãªã„ã‚ˆã†ã«ã™ã‚‹ */
.lawbar .kwstatus{
  flex: 0 0 100%;          /* å¸¸ã«ã€Œæ¬¡ã®è¡Œã€ã«å›ã™ */
  margin-left: 0;
  margin-top: 4px;
  white-space: nowrap;      /* 1è¡Œã«ã™ã‚‹ */
  overflow: hidden;
  text-overflow: ellipsis;  /* é•·ã„ã¨ãã¯â€¦ */
}
.lawbar{
  display:flex;
  align-items:center;
  flex-wrap:wrap;
  column-gap:4px;  /* æ¨ªã®é–“ */
  row-gap:4px;     /* ç¸¦ã®é–“ */
}


</style>
</head>
<body>
<header><span class="badge"><span class="micon">ğŸ°</span>JUNNAã®å…­æ³•</span></header>
<main>
  <div class="card">
    <div class="small">æ³•ä»¤åï¼ˆéƒ¨åˆ†ä¸€è‡´ï¼‰ï¼‹æ¡ç•ªå·ï¼ˆæ•°å­—ï¼‰</div>

    <label for="lawq">æ³•ä»¤å</label>
    <input id="lawq" autocomplete="off" placeholder="ä¾‹ï¼šæ°‘æ³• / ä¸ç™»æ³• / ä¾›è¨—">

    <label for="artq">æ¡ç•ªå·</label>
    <input id="artq" inputmode="numeric" placeholder="ä¾‹ï¼š709 / 709-2 / 1-4">

    <button id="btn">ğŸ” æ¤œç´¢</button>

    <div id="status" class="small" style="margin-top:10px;">
      <span class="loading"><span class="dot"></span>æ¤œç´¢ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­â€¦</span>
    </div>

    <div class="small">æ¡ç•ªå·ãŒç©ºã§ã€æ³•ä»¤ãŒ1ä»¶ã«çµã‚ŒãŸå ´åˆã¯ã€ãã®æ³•ä»¤ãƒšãƒ¼ã‚¸ã¸ç§»å‹•ã—ã¾ã™</div>
  </div>

  <div class="card">
    <h3 style="margin:0 0 8px;"><span style="margin-right:6px;">ğŸ§</span>çµæœ</h3>
    <div id="r"></div>
  </div>

  <details id="lawsPanel" style="margin-top:8px;">
    <summary>æ³•ä»¤ä¸€è¦§ï¼ˆé–‹ãï¼‰</summary>
    <div class="small">å¤šã„ã®ã§æŠ˜ã‚ŠãŸãŸã¿</div>
    <div id="lawlist" class="small"></div>
  </details>
</main>

<script>
let DATA = null;

function norm(s){ return (s||"").replace(/\s+/g,"").trim(); }

function normalizeArtInput(s){
  s = norm(s);
  if(!s) return "";
  s = s.replace(/^ç¬¬/,"").replace(/æ¡$/,"");
  let m = s.match(/^(\d+)(?:æ¡)?(?:ã®|ãƒ)(\d+)$/);
  if(m) return String(parseInt(m[1],10)) + "-" + String(parseInt(m[2],10));
  m = s.match(/^(\d+)\-(\d+)$/);
  if(m) return String(parseInt(m[1],10)) + "-" + String(parseInt(m[2],10));
  if(/^\d+$/.test(s)) return String(parseInt(s,10));
  return s;
}

function renderResults(items){
  const box = document.getElementById("r");
  if(!items || items.length===0){
    box.innerHTML = "<div class='small'>ï¼ˆè©²å½“ãªã—ï¼‰</div>";
    return;
  }
  let out = "";
  items.slice(0,200).forEach(d=>{
    out += `<div class="result">
      <a href="${d.url}"><b>${d.law}</b> / ${d.article}</a>
      <div class="small">${d.snippet || ""}</div>
    </div>`;
  });
  box.innerHTML = out;
}

function doSearch(){
  if(!DATA){
    document.getElementById("status").innerHTML =
      "<span class='small'>æ¤œç´¢ãƒ‡ãƒ¼ã‚¿æœªèª­è¾¼ã§ã™ï¼ˆå°‘ã—å¾…ã£ã¦ã‹ã‚‰ã‚‚ã†ä¸€åº¦ï¼‰</span>";
    return;
  }

  document.getElementById("lawq").blur();
  document.getElementById("artq").blur();

  const lawq = norm(document.getElementById("lawq").value);
  const artq = normalizeArtInput(document.getElementById("artq").value);

  const docs = DATA.docs;
  const lawMatched = lawq
    ? DATA.laws.filter(x => (x.law_key||"").includes(lawq) || (x.title||"").includes(lawq))
    : DATA.laws;

  if(!artq){
    if(lawq && lawMatched.length === 1){
      window.location.href = lawMatched[0].url;
      return;
    }
    const pseudo = lawMatched.slice(0,200).map(x=>({
      law: x.title, article: "ï¼ˆæ¡æ–‡ï¼‰", url: x.url, snippet:""
    }));
    renderResults(pseudo);
    return;
  }

  let cand = docs;
  if(lawq){
    const lawKeys = new Set(lawMatched.map(x=>x.law_key));
    cand = cand.filter(d => lawKeys.has(d.law_key));
  }

  let hits = cand.filter(d => (d.art_key || "") === artq);
  if(hits.length === 0){
    hits = cand.filter(d => norm(d.article || "").includes(artq));
  }
  renderResults(hits);
}

async function loadData(){
  const mf = await (await fetch("search_manifest.json")).json();
  const lawsObj = await (await fetch("search_laws.json")).json();

  let docs = [];
  for(const fn of (mf.doc_files || [])){
    const part = await (await fetch(fn)).json();
    docs = docs.concat(part.docs || []);
  }
  return { laws: lawsObj.laws || [], docs };
}

async function init(){
  try{
    DATA = await loadData();

    const ll = document.getElementById("lawlist");
    const laws = DATA.laws.slice().sort((a,b)=> (a.title||"").localeCompare(b.title||"", "ja"));
    ll.innerHTML = laws.map(x=>`<a href="${x.url}">${x.title}</a>`).join(" / ");
    document.getElementById("lawsPanel").open = false;

    document.getElementById("btn").addEventListener("click", doSearch);
    document.getElementById("lawq").addEventListener("keydown", e=>{ if(e.key==="Enter") doSearch(); });
    document.getElementById("artq").addEventListener("keydown", e=>{ if(e.key==="Enter") doSearch(); });

    document.getElementById("status").innerHTML =
      "<span class='small'>âœ… æº–å‚™OKï¼ˆæ¤œç´¢ã§ãã¾ã™ï¼‰</span>";
  }catch(e){
    console.error(e);
    document.getElementById("status").innerHTML =
      "<span class='small'>âŒ æ¤œç´¢ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</span>";
  }
}
init();
</script>

</body>
</html>
