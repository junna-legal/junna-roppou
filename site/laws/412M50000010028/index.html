<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>電気通信回線による登記情報の提供に関する法律施行規則</title>
<style>
:root {
  --bg: #fffafc;
  --card: #ffffff;
  --text: #374151;
  --sub: #9ca3af;

  --pink: #fde2e4;
  --mint: #e8f8f5;
  --lav:  #f3ecff;

  font-family: -apple-system, BlinkMacSystemFont,
    "Hiragino Maru Gothic ProN","Hiragino Sans","Yu Gothic UI",
    system-ui, sans-serif;

  line-height: 1.75;
}

* { box-sizing: border-box; }
body {
  margin: 0;
  background: linear-gradient(180deg, var(--bg), #ffffff);
  color: var(--text);
  overflow-x: hidden;
}

header{
  position: sticky;
  top: 0;
  background: rgba(255,255,255,0.85);
  backdrop-filter: blur(10px);
  border-bottom: 1px solid rgba(0,0,0,.06);
  padding: 10px 12px; /* ← 12→10 にして少し低く */
  z-index: 10;
}


main {
  padding: 14px 12px calc(24px + env(safe-area-inset-bottom));
  max-width: 760px;
  margin: 0 auto;
}

.card {
  background: var(--card);
  border-radius: 24px;
  padding: 16px 14px;
  margin-bottom: 14px;
  box-shadow: 0 8px 24px rgba(0,0,0,.04), 0 2px 6px rgba(0,0,0,.03);
}

.badge {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 7px 12px;
  border-radius: 999px;
  background: linear-gradient(90deg, var(--pink), var(--lav));
  border: 1px solid rgba(0,0,0,.04);
  font-size: 13px;
  color: #111827;
  font-weight: 800;
}

.micon{
  width: 22px; height: 22px;
  display: inline-grid; place-items: center;
  border-radius: 999px;
  background: rgba(255,255,255,0.85);
  border: 1px solid rgba(0,0,0,.06);
  box-shadow: 0 2px 6px rgba(0,0,0,.06);
}
.micon svg{ width: 18px; height: 18px; display:block; }

.small { color: var(--sub); font-size: 0.92em; margin-top: 6px; }
hr { border: none; border-top: 1px solid rgba(0,0,0,.08); margin: 12px 0; }

label { display: block; font-weight: 800; margin-top: 10px; }
input {
  width: 100%;
  font-size: 16px;
  padding: 11px 12px;
  border-radius: 16px;
  border: 1px solid rgba(0,0,0,.10);
  background: #fff;
}

button {
  font-size: 16px;
  padding: 11px 14px;
  border-radius: 999px;
  border: 1px solid rgba(0,0,0,.10);
  background: linear-gradient(90deg, var(--mint), var(--lav));
  color: #111827;
  margin-top: 10px;
}

.navrow { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
.navbtn {
  display: inline-flex; align-items: center; gap: 8px;
  padding: 9px 12px;
  border-radius: 999px;
  text-decoration: none;
  border: 1px solid rgba(0,0,0,.10);
  background: #fff;
  color: #111827;
}
.navbtn.primary { background: linear-gradient(90deg, var(--mint), var(--lav)); }
.navbtn:active { opacity: .7; }

.result { padding: 10px 4px; border-bottom: 1px dashed rgba(0,0,0,.12); }
.result a { text-decoration: none; display: block; color: #111827; }

.p { margin: 0 0 12px; }
.sp { height: 6px; }
.cute-list { margin: 8px 0 14px 18px; padding: 0; }
.cute-list li { margin: 8px 0; }

.loading {
  display:inline-flex; align-items:center; gap:8px;
  padding:8px 10px;
  border-radius:999px;
  border:1px solid rgba(0,0,0,.08);
  background: rgba(255,255,255,.8);
  color:#374151;
  font-size: 14px;
}
.dot {
  width:10px;height:10px;border-radius:999px;
  background: linear-gradient(90deg, var(--pink), var(--lav));
  box-shadow: 0 2px 6px rgba(0,0,0,.06);
}

.artbox{
  border:1px solid rgba(0,0,0,.08);
  border-radius: 20px;
  padding: 14px 12px;
  margin: 12px 0;
  background: linear-gradient(180deg, rgba(232,248,245,.35), rgba(243,236,255,.35));
}
.arthead{
  font-weight: 900;
  margin: 0 0 8px;
  display:flex;
  align-items:center;
  gap:4px;
}
.artnum{
  display:inline-flex;
  align-items:center;
  padding: 6px 10px;
  border-radius: 999px;
  background: rgba(255,255,255,.8);
  border:1px solid rgba(0,0,0,.06);
  font-size: 13px;
}
.toc a{ text-decoration:none; color:#111827; }
.toc a:hover{ text-decoration:underline; }
/* アンカー移動でヘッダーに隠れないようにする */
.artbox{
  scroll-margin-top: 90px;
}
/* 法令ページのヘッダー内：条番号ジャンプ */
.headbar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  flex-wrap:wrap;
}
/* 条番号ジャンプ行 */
.headjump{
  display:flex;
  gap:8px;
  width:100%;
  justify-content:flex-end;  /* 右寄せ */
}

/* ★ここで幅を狭くする */
.headjump input{
  flex: 0 0 auto;
  width: min(80px, 55vw);   /* ←狭め（数値は好みで調整） */
  padding: 9px 10px;
  border-radius: 999px;
}

.headjump button{
  margin-top:0;
  padding: 9px 12px;
  border-radius: 999px;
  white-space:nowrap;
}

/* 小さい画面は少しだけ広げる（入力しやすさ優先） */
@media (max-width: 520px){
  .headjump input{
    width: min(220px, 62vw);
  }
/* ふわっと感UP */
.card{
  box-shadow: 0 10px 30px rgba(0,0,0,.05), 0 2px 8px rgba(0,0,0,.03);
  border: 1px solid rgba(0,0,0,.04);
}

/* ボタンをぷにっと */
button, .navbtn{
  transition: transform .06s ease, filter .12s ease;
}
button:active, .navbtn:active{
  transform: translateY(1px) scale(0.98);
  filter: brightness(0.98);
}

/* 見出しバッジをもっと“お菓子”っぽく */
.badge{
  box-shadow: 0 6px 18px rgba(0,0,0,.06);
}



/* 入力欄を“ぷに” */
input{
  border: 1px solid rgba(0,0,0,.08);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.8);
}
input:focus{
  outline: none;
  border-color: rgba(244,114,182,.35);
  box-shadow: 0 0 0 4px rgba(244,114,182,.10);
}

}
.hit { outline: 3px solid rgba(253, 226, 228, .9); }
.mark { background: rgba(253, 226, 228, .75); border-radius: 6px; padding: 0 2px; }
/* ===== iPhone等の狭い画面だけ、ヘッダー内検索UIを圧縮 ===== */
.lawbar{
  display:flex;
  align-items:center;
  gap:8px;
  flex-wrap:wrap;
}

.lawbar .field{
  display:flex;
  align-items:center;
  gap:4px;
}
.lawbar .field-kw{
  flex: 0 1 auto;   /* ← “必要な分だけ”に寄せる */
}

.lawbar input{
  width:auto;
}

.lawbar .artjump{
  width: 9.5em;         /* 条番号は短めでOK */
  max-width: 45vw;
  flex: 0 0 auto;
}

.lawbar .kw{
  flex: 1 1 9.5em;       /* ★キーワードを広げる（優先） */
  min-width: 12em;
  max-width: 45vw;
}

/* ボタンを少し小さく */
.lawbar .mini-btn{
  padding: 8px 10px;
  font-size: 14px;
}

/* iPhone想定のさらに圧縮 */
@media (max-width: 480px){
  header{ padding: 10px 10px; }
  .badge{ padding: 6px 10px; font-size: 12px; }
  .micon{ width: 20px; height: 20px; }
  .lawbar{ gap:6px; }

/* 変更後：iPhoneでも同じ幅 */
.lawbar .artjump,
.lawbar .kw{
  width: 7.0em;
  max-width: 42vw;
}


  /* 入力自体も少し小さめ */
  .lawbar input{
    padding: 9px 10px;
    border-radius: 14px;
    font-size: 15px;
  }
}
/* 検索結果表示（kwstatus）が横幅を食って折り返し崩れないようにする */
.lawbar .kwstatus{
  flex: 0 0 100%;          /* 常に「次の行」に回す */
  margin-left: 0;
  margin-top: 4px;
  white-space: nowrap;      /* 1行にする */
  overflow: hidden;
  text-overflow: ellipsis;  /* 長いときは… */
}
.lawbar{
  display:flex;
  align-items:center;
  flex-wrap:wrap;
  column-gap:4px;  /* 横の間 */
  row-gap:4px;     /* 縦の間 */
}


</style>
</head>
<body>


<header>
  <div class="navrow" style="justify-content:space-between; gap:10px;">
    <span class="badge"><span class="micon">🐰</span>電気通信回線による登記情報の提供に関する法律施行規則</span>
    <a class="navbtn" href="../../index.html">← 検索</a>
  </div>

  <div class="lawbar" style="margin-top:6px;">
    <div class="field" style="flex:0 1 auto;">
      <span class="small" style="font-weight:800;">条番号</span>
      <input id="artjump" class="artjump" inputmode="numeric" placeholder="例: 709 / 709-2">
      <button id="artbtn" class="mini-btn">移動</button>
    </div>

    <div class="field field-kw">
      <span class="small" style="font-weight:800;">ＫＷ</span>
      <input id="kw" class="kw" placeholder="法令内検索">
      <button id="kwbtn" class="mini-btn">検索</button>
      <button id="kwprev" class="mini-btn">前</button>
      <button id="kwnext" class="mini-btn">次</button>
      <span id="kwstatus" class="small kwstatus"></span>
    </div>
  </div>
</header>

<main>
  <div class="card">
    <div class="small">LawId: 412M50000010028</div>
    <div class='small'>現行版基準日(推定): 2024-10-01</div>
    <div class='navrow'><span class='small'>← 前へ</span><a class='navbtn primary' href='../../index.html'>🔍 検索</a><span class='small'>次へ →</span></div>
    <hr>
    <div class="toc"><div>・ <a href='index.html#a1'>第一条（登記情報の調製方法）</a></div>
<div>・ <a href='index.html#a1'>第一条の二（提供する情報の範囲）</a></div>
<div>・ <a href='index.html#a2'>第二条（変更の届出）</a></div>
<div>・ <a href='index.html#a3'>第三条（手数料の納付方法）</a></div>
<div>・ <a href='index.html#a4'>第四条（業務規程）</a></div>
<div>・ <a href='index.html#a5'>第五条（事業計画等）</a></div>
<div>・ <a href='index.html#a6'>第六条（業務の休廃止）</a></div>
<div>・ <a href='index.html#a7'>第七条（情報提供契約の締結の拒絶）</a></div>
<div>・ <a href='index.html#a8'>第八条（情報提供契約の解除）</a></div>
<div>・ <a href='index.html#a9'>第九条（役員の選任及び解任）</a></div>
<div>・ <a href='index.html#a10'>第十条（身分を示す証明書）</a></div>
<div>・ <a href='index.html#a1'>第一条（施行期日）</a></div>
<div>・ <a href='index.html#a1'>第一条（施行期日）</a></div>
<div>・ <a href='index.html#a1'>第一条（施行期日）</a></div>
<div>・ <a href='index.html#a1'>第一条（施行期日）</a></div>
<div>・ <a href='index.html#a1'>第一条（施行期日）</a></div>
<div>・ <a href='index.html#a3'>第三条（経過措置）</a></div>
<div>・ <a href='index.html#a1'>第一条（施行期日）</a></div>
<div>・ <a href='index.html#a1'>第一条（施行期日）</a></div></div>
    <hr>
    <section class='artbox' id='a1'><div class='arthead'><span class='artnum'>🍬 第一条（登記情報の調製方法）</span></div><p class='p'>電気通信回線による登記情報の提供に関する法律（平成十一年法律第二百二十六号。以下「法」という。）第二条第一項の登記情報は、登記記録の記録に係る電子計算機に備えられたファイル又は電磁的記録媒体をもって調製されたものに記録されている情報を含むものとする。</p></section>
<section class='artbox' id='a1'><div class='arthead'><span class='artnum'>🍬 第一条の二（提供する情報の範囲）</span></div><p class='p'>法第二条第一項ただし書の法務省令で定めるものは、次の各号に掲げるものとする。</p>
<ul class='cute-list'>
<li>一  不動産の登記簿に記録されている登記情報のうち、請求に係る情報量が一メガバイトを超えるもの</li>
<li>二  商業登記簿、法人（株式会社、合名会社、合資会社、合同会社及び外国会社を除く。以下この条において同じ。）の登記簿、投資事業有限責任組合契約登記簿、有限責任事業組合契約登記簿、限定責任信託登記簿又は動産譲渡登記事項概要ファイル若しくは債権譲渡登記事項概要ファイルに記録されている登記情報のうち、請求に係る情報量が三メガバイトを超えるもの</li>
<li>二の二  商業登記簿、法人の登記簿、投資事業有限責任組合契約登記簿、有限責任事業組合契約登記簿又は限定責任信託登記簿に記録されている登記情報のうち、商業登記規則（昭和三十九年法務省令第二十三号）第三十一条の二第一項（他の法令において準用する場合を含む。）の規定による住所非表示措置又は同規則第三十一条の三第二項の規定による代表取締役等住所非表示措置が講じられることとなるもの</li>
<li>三  商業登記規則第四十四条第一項（他の省令において準用する場合を含む。）の規定により閉鎖された登記事項についての登記情報。</li>
</ul>
<p class='p'>ただし、同規則第十一条第二項、第五十四条第二項、第五十五条第二項、第五十七条第二項、第八十条第二項、第八十一条第一項、第九十六条第二項又は第百十七条第三項（これらの規定を同規則又は他の省令において準用する場合を含む。）の規定により閉鎖された登記記録に係るものを除く。</p>
<ul class='cute-list'>
<li>四  地図、建物所在図、地図に準ずる図面及び不動産登記令（平成十六年政令第三百七十九号）第二十一条第一項に規定する図面が記録されたファイルに記録されている情報のうち、次に掲げるもの</li>
<li>イ 請求に係る図面に関する事件の数が九十九を超えるもの</li>
<li>ロ 請求に係る一事件に関する図面について出力装置の映像面に表示すべき画面の数が五十を超えるもの</li>
<li>ハ 請求に係る情報量が三メガバイトを超えるもの</li>
<li>五  不動産登記規則（平成十七年法務省令第十八号）第十二条第一項（同条第四項において準用する場合を含む。）、第八十五条第二項又は第八十七条第一項の規定により閉鎖された図面についての情報</li>
<li>六  電気通信回線による登記情報の提供に関する法律施行令（平成十二年政令第百七十七号）第七号及び第八号に掲げる登記簿に記録されている登記情報のうち、日本産業規格Ｘ〇二一三（平成十六年二月二十日において経済産業大臣が公示した産業標準化法（昭和二十四年法律第百八十五号）第十四条の規定に基づく改正後のもの）に適合する登記記録に係るもの</li>
</ul>
<div class='sp'></div>
<p class='p'>２  法第二条第一項第二号の法務省令で定めるものは、次の各号に掲げるものとする。</p>
<ul class='cute-list'>
<li>一  不動産についての登記簿の登記記録に記録されている事項の全部から次に掲げるもののいずれか又は全てを除いたものについての情報</li>
<li>イ 共同担保目録の全部又は現在効力を有していないもの</li>
<li>ロ 信託目録の全部又は現在効力を有していないもの</li>
<li>二  不動産の所有権の登記名義人の氏名又は名称、住所及び不動産登記規則第百五十六条の四に規定する法人識別事項並びに当該登記名義人が二人以上であるときは当該登記名義人ごとの持分のみについての情報</li>
<li>三  商業登記簿、法人の登記簿、投資事業有限責任組合契約登記簿、有限責任事業組合契約登記簿又は限定責任信託登記簿の登記記録に係る情報量が三メガバイトを超える場合における当該登記記録中次に掲げる区に記録されている事項の全部についての情報</li>
<li>イ 商号登記簿、未成年者登記簿、後見人登記簿又は支配人登記簿にあっては、商号区、未成年者区、後見人区又は支配人区</li>
<li>ロ 商業登記簿（イに掲げる登記簿を除く。）、法人の登記簿、投資事業有限責任組合契約登記簿、有限責任事業組合契約登記簿又は限定責任信託登記簿にあっては、商号区又は名称区及び会社状態区、法人状態区、組合状態区又は信託状態区並びに請求に係るその他の区</li>
</ul></section>
<section class='artbox' id='a2'><div class='arthead'><span class='artnum'>🍬 第二条（変更の届出）</span></div><p class='p'>指定法人は、法第三条第三項の規定による届出をしようとするときは、次に掲げる事項を記載した届出書を法務大臣に提出しなければならない。</p>
<ul class='cute-list'>
<li>一  変更後の名称又は主たる事務所の所在地</li>
<li>二  変更しようとする年月日</li>
<li>三  変更の理由</li>
</ul></section>
<section class='artbox' id='a3'><div class='arthead'><span class='artnum'>🍬 第三条（手数料の納付方法）</span></div><p class='p'>法第四条第三項の手数料の納付は、納入の告知に従い、毎月二十五日までにその前々月分の手数料の合計額を日本銀行に納付する方法によってしなければならない。</p></section>
<section class='artbox' id='a4'><div class='arthead'><span class='artnum'>🍬 第四条（業務規程）</span></div><p class='p'>法第五条第二項の法務省令で定める事項は、次のとおりとする。</p>
<ul class='cute-list'>
<li>一  登記情報提供業務の実施方法</li>
<li>二  登記情報提供業務に関する料金</li>
<li>三  前号の料金の支払方法</li>
<li>四  情報提供契約の約款</li>
<li>五  登記情報提供業務に関して得られた情報の目的外使用の禁止その他管理に関する事項</li>
<li>六  登記情報の安全性の確保に関する事項</li>
<li>七  その他登記情報提供業務に関し必要な事項</li>
</ul>
<div class='sp'></div>
<p class='p'>２  指定法人は、法第五条第一項前段の規定により業務規程の認可を受けようとするときは、その旨を記載した申請書に業務規程を添えて法務大臣に提出しなければならない。</p>
<div class='sp'></div>
<p class='p'>３  指定法人は、法第五条第一項後段の規定により業務規程の変更の認可を受けようとするときは、次に掲げる事項を記載した申請書を法務大臣に提出しなければならない。</p>
<ul class='cute-list'>
<li>一  変更しようとする事項</li>
<li>二  変更しようとする年月日</li>
<li>三  変更の理由</li>
</ul></section>
<section class='artbox' id='a5'><div class='arthead'><span class='artnum'>🍬 第五条（事業計画等）</span></div><p class='p'>指定法人は、法第六条第一項前段の規定により事業計画及び収支予算の認可を受けようとするときは、その旨を記載した申請書に事業計画書及び収支予算書を添えて法務大臣に提出しなければならない。</p>
<div class='sp'></div>
<p class='p'>２  指定法人は、法第六条第一項後段の規定により事業計画又は収支予算の変更の認可を受けようとするときは、次に掲げる事項を記載した申請書を法務大臣に提出しなければならない。</p>
<ul class='cute-list'>
<li>一  変更しようとする事項</li>
<li>二  変更しようとする年月日</li>
<li>三  変更の理由</li>
</ul></section>
<section class='artbox' id='a6'><div class='arthead'><span class='artnum'>🍬 第六条（業務の休廃止）</span></div><p class='p'>指定法人は、法第七条の許可を受けようとするときは、次に掲げる事項を記載した申請書を法務大臣に提出しなければならない。</p>
<ul class='cute-list'>
<li>一  休止し、又は廃止しようとする登記情報提供業務の範囲</li>
<li>二  休止し、又は廃止しようとする年月日</li>
<li>三  休止しようとする場合にあっては、その期間</li>
<li>四  休止又は廃止の理由</li>
</ul></section>
<section class='artbox' id='a7'><div class='arthead'><span class='artnum'>🍬 第七条（情報提供契約の締結の拒絶）</span></div><p class='p'>法第八条第一項の法務省令で定める正当な理由は、次のとおりとする。</p>
<ul class='cute-list'>
<li>一  情報提供契約の申込者が、業務規程で定める料金の支払方法によって、当該料金を支払うことができないこと、又は当該料金を支払う資力を有することについて合理的な疑いが認められること。</li>
<li>二  情報提供契約の申込者が法第八条第二項又は次条に規定する正当な理由により情報提供契約を解除され、その解除の日から起算して一年を経過しない者であること。</li>
<li>三  情報提供契約の申込者がその申込みに関し偽りその他不正の行為を行ったこと。</li>
</ul></section>
<section class='artbox' id='a8'><div class='arthead'><span class='artnum'>🍬 第八条（情報提供契約の解除）</span></div><p class='p'>法第八条第二項の法務省令で定める正当な理由は、次のとおりとする。</p>
<ul class='cute-list'>
<li>一  情報提供契約を締結した者の契約上の義務違反により契約関係を継続し難い重大な事由があると認められること。</li>
<li>二  情報提供契約を締結した者が継続して一年間法第四条第一項の委託をしないこと。</li>
</ul></section>
<section class='artbox' id='a9'><div class='arthead'><span class='artnum'>🍬 第九条（役員の選任及び解任）</span></div><p class='p'>指定法人は、法第十条第一項の認可を受けようとするときは、次に掲げる事項を記載した申請書を法務大臣に提出しなければならない。</p>
<ul class='cute-list'>
<li>一  選任又は解任に係る役員の氏名及び略歴</li>
<li>二  選任又は解任の年月日</li>
<li>三  選任又は解任の理由</li>
</ul></section>
<section class='artbox' id='a10'><div class='arthead'><span class='artnum'>🍬 第十条（身分を示す証明書）</span></div><p class='p'>法第十二条第二項の証明書は、別添様式によるものとする。</p></section>
<section class='artbox' id='a1'><div class='arthead'><span class='artnum'>🍬 第一条（施行期日）</span></div><p class='p'>この省令は、平成十七年三月七日から施行する。</p></section>
<section class='artbox' id='a1'><div class='arthead'><span class='artnum'>🍬 第一条（施行期日）</span></div><p class='p'>この省令は、有限責任事業組合契約に関する法律（平成十七年法律第四十号）の施行の日から施行する。</p></section>
<section class='artbox' id='a1'><div class='arthead'><span class='artnum'>🍬 第一条（施行期日）</span></div><p class='p'>この省令は、債権譲渡の対抗要件に関する民法の特例等に関する法律の一部を改正する法律（次条第四項において「改正法」という。）の施行の日（平成十七年十月三日）から施行する。</p></section>
<section class='artbox' id='a1'><div class='arthead'><span class='artnum'>🍬 第一条（施行期日）</span></div><p class='p'>この省令は、会社法の施行の日（以下「施行日」という。）から施行する。</p></section>
<section class='artbox' id='a1'><div class='arthead'><span class='artnum'>🍬 第一条（施行期日）</span></div><p class='p'>この省令は、信託法の施行の日（平成十九年九月三十日）から施行する。</p></section>
<section class='artbox' id='a3'><div class='arthead'><span class='artnum'>🍬 第三条（経過措置）</span></div><p class='p'>不動産登記規則別記第四号様式において定める登記官の身分を証する書面の様式は、この省令の施行の日から起算して一年を経過する日までの間は、なお従前の様式によることができる。</p>
<div class='sp'></div>
<p class='p'>２  前項の規定は、電気通信回線による登記情報の提供に関する法律施行規則において定める職員の身分を示す証明書の様式について準用する。</p></section>
<section class='artbox' id='a1'><div class='arthead'><span class='artnum'>🍬 第一条（施行期日）</span></div><p class='p'>この省令は、平成二十四年二月二十日から施行する。</p></section>
<section class='artbox' id='a1'><div class='arthead'><span class='artnum'>🍬 第一条（施行期日）</span></div><p class='p'>この省令は、民法等の一部を改正する法律（以下「改正法」という。）附則第一条第二号に掲げる規定の施行の日（令和六年四月一日）から施行する。</p></section>
    <hr>
    <div class='navrow'><span class='small'>← 前へ</span><a class='navbtn primary' href='../../index.html'>🔍 検索</a><span class='small'>次へ →</span></div>
  </div>
</main>

<script>
(function(){
  const $ = (id)=>document.getElementById(id);

  function headerH(){
    const h = document.querySelector("header");
    return h ? h.getBoundingClientRect().height : 70;
  }

  function scrollToNode(node){
    if(!node) return;
    const rect = node.getBoundingClientRect();
    const y = window.pageYOffset + rect.top - Math.ceil(headerH()) - 10;
    window.scrollTo({ top: y, behavior: "smooth" });
  }

  let marks = [];
  let pos = -1;

  function clearMarks(){
    document.querySelectorAll(".mark").forEach(m=>{
      const t = document.createTextNode(m.textContent);
      m.replaceWith(t);
    });
    marks = [];
    pos = -1;
    document.querySelectorAll(".artbox").forEach(b=>b.classList.remove("hit"));
  }

  function norm(s){ return (s||"").toLowerCase(); }

  function markTextNode(node, q){
    const text = node.nodeValue || "";
    const qn = norm(q);
    const tn = norm(text);

    let idx = tn.indexOf(qn);
    if(idx === -1) return false;

    const frag = document.createDocumentFragment();
    let cur = 0;

    while(idx !== -1){
      const before = text.slice(cur, idx);
      if(before) frag.appendChild(document.createTextNode(before));

      const mid = text.slice(idx, idx + q.length);
      const span = document.createElement("span");
      span.className = "mark";
      span.textContent = mid;
      frag.appendChild(span);

      cur = idx + q.length;
      idx = tn.indexOf(qn, cur);
    }

    const after = text.slice(cur);
    if(after) frag.appendChild(document.createTextNode(after));

    node.parentNode.replaceChild(frag, node);
    return true;
  }

  function markInElement(el, q){
    const walker = document.createTreeWalker(el, NodeFilter.SHOW_TEXT);
    const nodes = [];
    while(walker.nextNode()) nodes.push(walker.currentNode);

    let found = false;
    for(const node of nodes){
      if(!(node.nodeValue||"").trim()) continue;
      if(markTextNode(node, q)) found = true;
    }
    return found;
  }

  function setStatus(msg){
    const s = $("kwstatus");
    if(s) s.textContent = msg || "";
  }

  function collectMarks(){
    marks = Array.from(document.querySelectorAll(".mark"));
    pos = marks.length ? 0 : -1;

    document.querySelectorAll(".artbox").forEach(b=>{
      if(b.querySelector(".mark")) b.classList.add("hit");
    });
  }

  function runSearch(){
    const q = ($("kw")?.value || "").trim();
    clearMarks();
    if(!q){ setStatus(""); return; }

    const boxes = Array.from(document.querySelectorAll(".artbox"));
    boxes.forEach(b=>{ markInElement(b, q); });

    collectMarks();

    if(marks.length){
      setStatus("ヒット: " + marks.length + " / 1");
      scrollToNode(marks[0]);
    }else{
      setStatus("（ヒットなし）");
    }
  }

  function goNext(){
    if(!marks.length) return;
    pos = (pos + 1) % marks.length;
    setStatus("ヒット: " + marks.length + " / " + (pos+1));
    scrollToNode(marks[pos]);
  }

  function goPrev(){
    if(!marks.length) return;
    pos = (pos - 1 + marks.length) % marks.length;
    setStatus("ヒット: " + marks.length + " / " + (pos+1));
    scrollToNode(marks[pos]);
  }

  async function jumpArticle(){
    const v = ($("artjump")?.value || "").trim();
    if(!v) return;

    const normv = (v.replace("／","/").replace("―","-").replace("−","-").replace("–","-")
                   .replace("の","-").replace("/", "-").replace(/\s+/g,""));

    try{
      const map = await (await fetch("artmap.json")).json();
      const anchor = map[normv];
      if(anchor){
        const el = document.getElementById(anchor);
        if(el) scrollToNode(el);
        else location.hash = "#" + anchor;
        return;
      }
    }catch(e){}

    const guess = "a" + normv.replace("-", "_");
    const el = document.getElementById(guess);
    if(el) scrollToNode(el);
    else location.hash = "#" + guess;
  }

  $("kwbtn")?.addEventListener("click", runSearch);
  $("kw")?.addEventListener("keydown", (e)=>{ if(e.key==="Enter") runSearch(); });
  $("kwnext")?.addEventListener("click", goNext);
  $("kwprev")?.addEventListener("click", goPrev);

  $("artbtn")?.addEventListener("click", jumpArticle);
  $("artjump")?.addEventListener("keydown", (e)=>{ if(e.key==="Enter") jumpArticle(); });

})();
</script>


</body>
</html>
